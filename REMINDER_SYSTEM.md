# üîî –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

## –û–±–∑–æ—Ä

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –¥–≤—É—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç—Ç–∞–ø–∞—Ö:
1. **–í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã** - –µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–ª–∏ —Ä—É–±–ª–∏/–≥—Ä–∏–≤–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ (RUB)** - –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ —Ä—É–±–ª–∏, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–≤–∏—Ç–∞–Ω—Ü–∏—é –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç

## 1. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—ã–±–æ—Ä –æ–ø–ª–∞—Ç—ã
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—à–µ–ª –¥–æ —ç—Ç–∞–ø–∞ –≤—ã–±–æ—Ä–∞ –æ–ø–ª–∞—Ç—ã (—Ä—É–±–ª–∏/–≥—Ä–∏–≤–Ω—ã), –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
- `paymentChoiceShownAt` - —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞–∑–∞
- `paymentReminderSent` - —Ñ–ª–∞–≥ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ `false`)

### 2. –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É `ReminderService` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- ‚úÖ –®–∞–≥: `payment_choice`
- ‚úÖ –í–∞–ª—é—Ç–∞: –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ (`null`)
- ‚úÖ –í—Ä–µ–º—è –ø–æ–∫–∞–∑–∞: –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
- ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:

**–°–æ–æ–±—â–µ–Ω–∏–µ:**
```
–•–æ—á–µ—à—å –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã?
```

**–ö–Ω–æ–ø–∫–∞:**
```
üì® –ù–∞–ø–∏—Å–∞—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É ‚Üí https://t.me/vetalsmirnov
```

### 4. –û—Ç–º–µ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏:
- `paymentReminderSent` ‚Üí `true`
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

### 5. –°–±—Ä–æ—Å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ä—É–±–ª–∏ –∏–ª–∏ –≥—Ä–∏–≤–Ω—ã:
- `paymentReminderSent` ‚Üí `false`
- `paymentChoiceShownAt` ‚Üí `null`
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –Ω–æ–≤–æ–º—É —Ü–∏–∫–ª—É (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –∫ –≤—ã–±–æ—Ä—É)

## 2. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ (RUB)

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø–ª–∞—Ç—É —Ä—É–±–ª—è–º–∏
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å —Ä—É–±–ª—è–º–∏", –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
- `waitingReceiptSince` - —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–∂–∏–¥–∞–Ω–∏—è –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
- `receiptReminderSent` - —Ñ–ª–∞–≥ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ `false`)

### 2. –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É `ReminderService` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- ‚úÖ –®–∞–≥: `waiting_receipt`
- ‚úÖ –í–∞–ª—é—Ç–∞: `RUB` (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—É–±–ª–µ–π)
- ‚úÖ –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
- ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:

**–°–æ–æ–±—â–µ–Ω–∏–µ:**
```
–ß—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–ø–ª–∞—Ç–æ–π —Ä—É–±–ª—è–º–∏? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ "–≤–∞–ª—é—Ç–∞ –∑–∞—á–∏—Å–ª–µ–Ω–∏—è" 
—É–∫–∞–∑–∞–Ω–∞ USD –∏ —É –≤–∞—Å —Å–∞–º–∞—è –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ñ—É–Ω–∫—Ü–∏—é –¥–æ–±–∞–≤–∏–ª–∏ 
–Ω–µ–¥–∞–≤–Ω–æ). –¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥ —á–µ—Ä–µ–∑ –≤–µ–±-–≤–µ—Ä—Å–∏—é —Å–≤–æ–µ–≥–æ –±–∞–Ω–∫–∞, 
—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º: –¢-–±–∞–Ω–∫, –ê–ª—å—Ñ–∞ –ë–∞–Ω–∫, –°–±–µ—Ä–±–∞–Ω–∫. –õ–∏–±–æ –Ω–∞–ø–∏—à–∏—Ç–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É!
```

**–ö–Ω–æ–ø–∫–∞:**
```
üì® –ù–∞–ø–∏—Å–∞—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É ‚Üí https://t.me/vetalsmirnov
```

### 4. –û—Ç–º–µ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏:
- `receiptReminderSent` ‚Üí `true`
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

### 5. –°–±—Ä–æ—Å –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–≤–∏—Ç–∞–Ω—Ü–∏—é, —Ñ–ª–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users`

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `paymentChoiceShownAt` | timestamp | –í—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ –≤—ã–±–æ—Ä–∞ –æ–ø–ª–∞—Ç—ã |
| `paymentReminderSent` | boolean | –§–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤—ã–±–æ—Ä–µ |
| `waitingReceiptSince` | timestamp | –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–∂–∏–¥–∞–Ω–∏—è –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ (RUB) |
| `receiptReminderSent` | boolean | –§–ª–∞–≥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ |

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/reminderService.ts` - –°–µ—Ä–≤–∏—Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (2 —Ç–∏–ø–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π)
- `src/entities/User.ts` - –û–±–Ω–æ–≤–ª–µ–Ω–∞ Entity —Å 4 –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- `src/userService.ts` - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `markPaymentChoiceShown()` –∏ `markWaitingForReceipt()`

### –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏

- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:** 5 –º–∏–Ω—É—Ç –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:** –Ω–µ—Ç (–∫–∞–∂–¥–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –ª–æ–≥–∞—Ö Railway –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã:

```
üîî –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π...
üìä –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–≤—ã–±–æ—Ä –æ–ø–ª–∞—Ç—ã): 2
üîî –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 123456789
‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 123456789
üìä –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–∫–≤–∏—Ç–∞–Ω—Ü–∏—è RUB): 1
üîî –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 987654321
‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 987654321
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –õ–µ–≥–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î (2 –∑–∞–ø—Ä–æ—Å–∞ –≤ –º–∏–Ω—É—Ç—É - –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–∏–ø –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –±–æ—Ç–∞

## Graceful Shutdown

–ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞:
```typescript
process.once('SIGTERM', () => {
  reminderService.stop(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª
  bot.stop('SIGTERM');
});
```

## SQL –∑–∞–ø—Ä–æ—Å—ã (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã:
```sql
SELECT * FROM users
WHERE 
  currentStep = 'payment_choice'
  AND currency IS NULL
  AND paymentReminderSent = false
  AND paymentChoiceShownAt <= NOW() - INTERVAL '5 minutes';
```

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ (RUB):
```sql
SELECT * FROM users
WHERE 
  currentStep = 'waiting_receipt'
  AND currency = 'RUB'
  AND receiptReminderSent = false
  AND waitingReceiptSince <= NOW() - INTERVAL '5 minutes';
```

## –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã
1. **14:00** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—ã–±–æ—Ä –æ–ø–ª–∞—Ç—ã
2. **14:05** - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
3. **14:07** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∏ –ø–∏—à–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏
1. **14:00** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å —Ä—É–±–ª—è–º–∏"
2. **14:05** - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
3. **14:10** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–≤–∏—Ç–∞–Ω—Ü–∏—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä (–±–µ–∑ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è)
1. **14:00** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—ã–±–æ—Ä –æ–ø–ª–∞—Ç—ã
2. **14:03** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ä—É–±–ª–∏
3. –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (–≤–∞–ª—é—Ç–∞ –≤—ã–±—Ä–∞–Ω–∞)

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
1. **14:00** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—ã–±–æ—Ä –æ–ø–ª–∞—Ç—ã
2. **14:05** - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
3. **14:10+** - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ–∂–∏–¥–∞—é—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤—ã–±–æ—Ä–µ –æ–ø–ª–∞—Ç—ã
SELECT userId, username, paymentChoiceShownAt, paymentReminderSent
FROM users
WHERE currentStep = 'payment_choice' 
  AND currency IS NULL
ORDER BY paymentChoiceShownAt DESC;

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ–∂–∏–¥–∞—é—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ (RUB)
SELECT userId, username, currency, waitingReceiptSince, receiptReminderSent
FROM users
WHERE currentStep = 'waiting_receipt' 
  AND currency = 'RUB'
ORDER BY waitingReceiptSince DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
SELECT 
  COUNT(*) FILTER (WHERE paymentReminderSent = true) as payment_choice_reminders,
  COUNT(*) FILTER (WHERE receiptReminderSent = true) as receipt_reminders
FROM users;
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–¥–µ—Ä–∂–∫–∏

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å 5 –º–∏–Ω—É—Ç –Ω–∞ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

–í —Ñ–∞–π–ª–µ `src/reminderService.ts`:
```typescript
private readonly REMINDER_DELAY_MS = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
```

–ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
```typescript
private readonly REMINDER_DELAY_MS = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç
```
