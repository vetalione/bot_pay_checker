/**
 * –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏ –ß–ü –î–µ–Ω—å 2 —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É
 */

import * as dotenv from 'dotenv';
dotenv.config();

import { Telegraf } from 'telegraf';
import { Input } from 'telegraf';

const bot = new Telegraf(process.env.BOT_TOKEN!);
const ADMIN_ID = 278263484;
const IMAGE_PATH = './Image_3_screen.jpeg';

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞ –ø–æ –∏–º–µ–Ω–∏
function detectGender(firstName: string): 'female' | 'male' {
  if (!firstName) return 'male';
  
  const name = firstName.toLowerCase().trim();
  
  // –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –º—É–∂—Å–∫–∏—Ö –∏–º–µ–Ω –Ω–∞ -–∞/-—è
  const maleExceptions = ['–Ω–∏–∫–∏—Ç–∞', '–∏–ª—å—è', '—Å–∞–≤–≤–∞', '–ª—ë–≤–∞', '–ª–µ–≤–∞', '–∫–æ–ª—è', '–≤–∞—Å—è', '–ø–µ—Ç—è', '—Å–∞—à–∞', '–∂–µ–Ω—è', '–≤–∞–ª—è', '–º–∏—à–∞'];
  if (maleExceptions.includes(name)) return 'male';
  
  // –ñ–µ–Ω—Å–∫–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è
  const femaleEndings = ['–∞', '—è', '–Ω–∞', '–ª–∞', '–∫–∞', '—à–∞', '—Å—è'];
  for (const ending of femaleEndings) {
    if (name.endsWith(ending)) return 'female';
  }
  
  return 'male';
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
function generateMessage(firstName: string, gender: 'female' | 'male'): string {
  const name = firstName || '–ü—Ä–∏–≤–µ—Ç';
  
  if (gender === 'female') {
    return `${name}, —É–∂–µ 100+ –¥–µ–≤—É—à–µ–∫ –≤–Ω—É—Ç—Ä–∏ üî•

–í—á–µ—Ä–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∞ <b>–ß—ë—Ä–Ω—É—é –ü—è—Ç–Ω–∏—Ü—É</b> ‚Äî –ø–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∑–∞ $25.

–ú–Ω–æ–≥–∏–µ —É–∂–µ –∑–∞–±—Ä–∞–ª–∏. –ù–æ —Ç—ã –µ—â—ë –º–æ–∂–µ—à—å —É—Å–ø–µ—Ç—å ‚Äî <b>–æ—Å—Ç–∞–ª–æ—Å—å —Ä–æ–≤–Ω–æ 48 —á–∞—Å–æ–≤.</b>

–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?
–ß–µ—Ä–µ–∑ 2 –¥–Ω—è –≤—Å—ë –ø–µ—Ä–µ–π–¥—ë—Ç –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É $30/–º–µ—Å. –°–µ–π—á–∞—Å ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –≤–∑—è—Ç—å <b>–æ–¥–∏–Ω —Ä–∞–∑ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞.</b>

<b>–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∑–∞ $25:</b>

üìä –ö–∞—Ä—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ä–∏–ª—Å (34 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
ü§ñ 7 –ø—Ä–æ–º—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
üìà –í–æ—Ä–∫–±—É–∫-—Ç—Ä–µ–∫–µ—Ä –Ω–∞ 30 –¥–Ω–µ–π
üí¨ –ó–∞–∫—Ä—ã—Ç—ã–π —á–∞—Ç + —Ä–∞–∑–±–æ—Ä—ã + –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ù–∏–∫–∞–∫–∏—Ö –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö —Å–ø–∏—Å–∞–Ω–∏–π. –ù–∏–∫–∞–∫–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫.
<b>$25 —Å–µ–π—á–∞—Å = –¥–æ—Å—Ç—É–ø –Ω–∞–≤—Å–µ–≥–¥–∞.</b>

‚è∞ –ß–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤ —Ü–µ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è.
–ù–µ —É–ø—É—Å—Ç–∏ –º–æ–º–µ–Ω—Ç ‚ù§Ô∏è`;
  } else {
    return `${name}, —É–∂–µ 100+ —á–µ–ª–æ–≤–µ–∫ –≤–Ω—É—Ç—Ä–∏ üî•

–í—á–µ—Ä–∞ –∑–∞–ø—É—Å—Ç–∏–ª <b>–ß—ë—Ä–Ω—É—é –ü—è—Ç–Ω–∏—Ü—É</b> ‚Äî –ø–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∑–∞ $25.

–ú–Ω–æ–≥–∏–µ —É–∂–µ –∑–∞–±—Ä–∞–ª–∏. –ù–æ —Ç—ã –µ—â—ë –º–æ–∂–µ—à—å —É—Å–ø–µ—Ç—å ‚Äî <b>–æ—Å—Ç–∞–ª–æ—Å—å —Ä–æ–≤–Ω–æ 48 —á–∞—Å–æ–≤.</b>

–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?
–ß–µ—Ä–µ–∑ 2 –¥–Ω—è –≤—Å—ë –ø–µ—Ä–µ–π–¥—ë—Ç –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É $30/–º–µ—Å. –°–µ–π—á–∞—Å ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –≤–∑—è—Ç—å <b>–æ–¥–∏–Ω —Ä–∞–∑ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞.</b>

<b>–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∑–∞ $25:</b>

üìä –ö–∞—Ä—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ä–∏–ª—Å (34 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
ü§ñ 7 –ø—Ä–æ–º—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
üìà –í–æ—Ä–∫–±—É–∫-—Ç—Ä–µ–∫–µ—Ä –Ω–∞ 30 –¥–Ω–µ–π
üí¨ –ó–∞–∫—Ä—ã—Ç—ã–π —á–∞—Ç + —Ä–∞–∑–±–æ—Ä—ã + –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ù–∏–∫–∞–∫–∏—Ö –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö —Å–ø–∏—Å–∞–Ω–∏–π. –ù–∏–∫–∞–∫–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫.
<b>$25 —Å–µ–π—á–∞—Å = –¥–æ—Å—Ç—É–ø –Ω–∞–≤—Å–µ–≥–¥–∞.</b>

‚è∞ –ß–µ—Ä–µ–∑ 48 —á–∞—Å–æ–≤ —Ü–µ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è.
–ù–µ —É–ø—É—Å—Ç–∏ –º–æ–º–µ–Ω—Ç üî•`;
  }
}

async function sendToAdmin() {
  console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é —Ç–µ—Å—Ç–æ–≤—É—é —Ä–∞—Å—Å—ã–ª–∫—É –ß–ü –î–µ–Ω—å 2 –∞–¥–º–∏–Ω—É...');
  
  try {
    // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∞–¥–º–∏–Ω–∞
    const adminInfo = await bot.telegram.getChat(ADMIN_ID);
    const firstName = 'first_name' in adminInfo ? adminInfo.first_name : '–ê–¥–º–∏–Ω';
    const gender = detectGender(firstName);
    const message = generateMessage(firstName, gender);
    
    await bot.telegram.sendPhoto(
      ADMIN_ID,
      Input.fromLocalFile(IMAGE_PATH),
      {
        caption: `<b>üß™ –¢–ï–°–¢ –†–ê–°–°–´–õ–ö–ò –ß–ü –î–ï–ù–¨ 2</b>\n\n${message}`,
        parse_mode: 'HTML',
        reply_markup: {
          inline_keyboard: [[
            { text: 'üíé –ó–∞–±—Ä–∞—Ç—å –¥–æ—Å—Ç—É–ø –∑–∞ $25', callback_data: 'payment_choice' }
          ]]
        }
      }
    );
    
    console.log('‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω—É!');
    console.log(`üìù –ü–æ–ª –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–∞–∫: ${gender === 'female' ? '–∂–µ–Ω—Å–∫–∏–π' : '–º—É–∂—Å–∫–æ–π'}`);
    console.log('üîò –ü—Ä–æ–≤–µ—Ä—å –∫–Ω–æ–ø–∫—É "üíé –ó–∞–±—Ä–∞—Ç—å –¥–æ—Å—Ç—É–ø –∑–∞ $25" - –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –≤–µ—Å—Ç–∏ –Ω–∞ –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
  }
  
  process.exit(0);
}

sendToAdmin();
