# Инструкция по деплою на Railway

## Шаг 1: Подготовка кода

1. Убедитесь, что все изменения закоммичены:
```bash
git add .
git commit -m "Ready for deployment"
```

2. Отправьте код в GitHub:
```bash
git push -u origin main
```

## Шаг 2: Настройка Railway

1. Зайдите на [railway.app](https://railway.app)
2. Войдите через GitHub
3. Нажмите "New Project"
4. Выберите "Deploy from GitHub repo"
5. Выберите репозиторий `vetalione/bot_pay_checker`

## Переменные окружения

- `BOT_TOKEN` - токен Telegram бота
- `GEMINI_API_KEY` - API ключ Google Gemini для проверки квитанций
- `CHANNEL_ID` - ID закрытого канала
- `CHANNEL_INVITE_LINK` - базовая ссылка на канал
- `PAYMENT_AMOUNT` - сумма платежа (по умолчанию 2000)
- `CARD_NUMBER` - номер карты для приема платежей
- `VIDEO_URL_1`, `VIDEO_URL_2`, `VIDEO_URL_3` - URL прогревающих видео

## Шаг 4: Настройка бота для webhook (опционально)

Если Railway выдаст публичный домен, добавьте переменную:
```
RAILWAY_PUBLIC_DOMAIN=your-app.railway.app
```

## Шаг 5: Деплой

Railway автоматически:
1. Обнаружит Node.js проект
2. Установит зависимости (`npm install`)
3. Скомпилирует TypeScript (`npm run build`)
4. Запустит бот (`npm start`)

## Локальное тестирование

Перед деплоем протестируйте локально:

1. Установите зависимости:
```bash
npm install
```

2. Создайте `.env` файл (скопируйте из `.env.example` и заполните данными)

3. Добавьте URL ваших видео в `.env`

4. Запустите в режиме разработки:
```bash
npm run dev
```

## Где взять URL видео

Вы можете загрузить видео:
1. На Telegram (отправьте боту @userinfobot видео и получите file_id)
2. На облачное хранилище (Google Drive, Dropbox, etc.)
3. На CDN (Cloudinary, AWS S3, etc.)

Для Telegram file_id используйте формат:
```env
VIDEO_URL_1=file_id_здесь
```

## Проверка работы бота

1. Найдите бота: @Reels_sale_bot
2. Отправьте `/start`
3. Проверьте отправку видео
4. Протестируйте процесс оплаты
5. Убедитесь, что генерируются invite-ссылки

## Мониторинг

В Railway:
- Смотрите логи в разделе "Deployments"
- Проверяйте метрики использования
- Настройте уведомления при ошибках

## Troubleshooting

### Бот не отвечает
- Проверьте, что процесс запущен в Railway
- Проверьте логи на ошибки
- Убедитесь, что BOT_TOKEN правильный

### Видео не отправляются
- Проверьте URL видео
- Убедитесь, что файлы доступны публично
- Проверьте формат (поддерживаются: mp4, avi, mov)

### Не генерируются invite-ссылки
- Убедитесь, что бот добавлен в канал как администратор
- Проверьте права бота (должен иметь возможность создавать invite links)
- Проверьте правильность CHANNEL_ID

### Ошибки при проверке квитанции
- В текущей версии используется **Gemini AI** для проверки квитанций
- Бот автоматически извлекает сумму и номер карты из изображения
- Проверяет на соответствие ожидаемым значениям
- Если Gemini API недоступен, используется fallback (упрощенная проверка)

## Обновление бота

1. Внесите изменения в код
2. Закоммитьте:
```bash
git add .
git commit -m "Update: описание изменений"
git push
```
3. Railway автоматически задеплоит новую версию

## Безопасность

⚠️ **НЕ КОММИТЬТЕ `.env` файл в Git!**

Он уже добавлен в `.gitignore`, но проверьте:
```bash
git status
```

Если `.env` показывается в staged files, удалите его:
```bash
git rm --cached .env
```
