# üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Tribute Webhook

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. ‚úÖ –°–æ–∑–¥–∞–Ω endpoint `/webhook/tribute` –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π
2. ‚úÖ Webhook —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–º –∂–µ –ø–æ—Ä—Ç—É —á—Ç–æ –∏ –±–æ—Ç (Railway PORT)
3. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π:
   - –ü–æ–º–µ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –æ–ø–ª–∞—Ç–∏–≤—à–µ–≥–æ –≤ –ë–î
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã (RUB/EUR)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω–≤–∞–π—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª –∏ —á–∞—Ç
4. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö webhook —Å–æ–±—ã—Ç–∏–π
5. ‚úÖ –ó–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Railway

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –ü–æ–ª—É—á–∏—Ç—å Railway URL

–í–∞—à –±–æ—Ç –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Railway –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

**–ù–∞–π–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ Railway Dashboard:**
- –û—Ç–∫—Ä–æ–π—Ç–µ https://railway.app/
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç —Å –±–æ—Ç–æ–º
- –ù–∞ –≤–∫–ª–∞–¥–∫–µ Settings ‚Üí Domain
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `your-bot-name.railway.app`)

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook –≤ Tribute

**–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Tribute Dashboard:**
- –û—Ç–∫—Ä–æ–π—Ç–µ https://tribute.app/ (–∏–ª–∏ https://my.tribute.app/)
- –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Settings** –∏–ª–∏ **API**

**–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook:**

```
API Key: 32fc5725-78c2-40aa-990d-dfebf6ec
Webhook URL: https://YOUR-RAILWAY-DOMAIN.railway.app/webhook/tribute
```

–ó–∞–º–µ–Ω–∏—Ç–µ `YOUR-RAILWAY-DOMAIN` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω Railway!

**–ü—Ä–∏–º–µ—Ä:**
```
Webhook URL: https://bot-pay-checker-production.railway.app/webhook/tribute
```

### 3. –£–∫–∞–∂–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è webhook

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Tribute –≤—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å webhook:

- ‚úÖ `new_subscription` - –Ω–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (–æ–ø–ª–∞—Ç–∞)
- ‚úÖ `subscription_renewed` - –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ `subscription_cancelled` - –æ—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –≤–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ `new_subscription`

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ endpoint:

```bash
curl https://YOUR-RAILWAY-DOMAIN.railway.app/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
```json
{"status":"ok","timestamp":"2025-11-18T..."}
```

### –¢–µ—Å—Ç–æ–≤—ã–π webhook –∑–∞–ø—Ä–æ—Å:

```bash
curl -X POST https://YOUR-RAILWAY-DOMAIN.railway.app/webhook/tribute \
  -H "Content-Type: application/json" \
  -d '{
    "name": "new_subscription",
    "created_at": "2025-11-18T10:00:00Z",
    "sent_at": "2025-11-18T10:00:00Z",
    "payload": {
      "subscription_name": "Test",
      "subscription_id": 999,
      "period_id": 999,
      "period": "monthly",
      "price": 2000,
      "amount": 1800,
      "currency": "rub",
      "user_id": 12345,
      "telegram_user_id": 123456789,
      "channel_id": 614,
      "channel_name": "test",
      "expires_at": "2025-12-18T10:00:00Z"
    }
  }'
```

**–ó–∞–º–µ–Ω–∏—Ç–µ:**
- `YOUR-RAILWAY-DOMAIN` - –≤–∞—à –¥–æ–º–µ–Ω
- `telegram_user_id: 123456789` - –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π Telegram ID –¥–ª—è —Ç–µ—Å—Ç–∞

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Railway Logs

–°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ Railway Dashboard ‚Üí Deployments ‚Üí Logs

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ webhook –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
üì• [2025-11-18T10:00:00.000Z] POST /webhook/tribute
üîî –ü–æ–ª—É—á–µ–Ω webhook –æ—Ç Tribute:
  Event: new_subscription
  Telegram User ID: 123456789
  Currency: RUB
  Price: 2000
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 123456789 –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –æ–ø–ª–∞—Ç–∏–≤—à–∏–π (RUB, 2000)
‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–Ω–≤–∞–π—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 123456789
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```python
python3 -c "
import asyncio
import asyncpg
import os
from dotenv import load_dotenv

load_dotenv()
DATABASE_URL = os.getenv('DATABASE_URL')

async def check():
    conn = await asyncpg.connect(DATABASE_URL)
    user = await conn.fetchrow('SELECT * FROM users WHERE \"userId\" = 123456789')
    if user:
        print('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω:')
        print(f'  hasPaid: {user[\"hasPaid\"]}')
        print(f'  paidAt: {user[\"paidAt\"]}')
        print(f'  currency: {user[\"currency\"]}')
    else:
        print('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω')
    await conn.close()

asyncio.run(check())
"
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–í–∞–∂–Ω–æ:** –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É signature –æ—Ç Tribute (–µ—Å–ª–∏ API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS (Railway –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
3. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ webhook —Ç–æ–ª—å–∫–æ —Å IP Tribute (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã)
4. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ endpoint

---

## üéØ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–ª–∞—Ç–µ–∂–µ:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç** —á–µ—Ä–µ–∑ Tribute (RUB –∏–ª–∏ EUR)
2. **Tribute –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook** –Ω–∞ `/webhook/tribute`
3. **–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:**
   - Telegram User ID
   - –í–∞–ª—é—Ç–∞ (RUB/EUR)
   - –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞
4. **–ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
   - –ù–∞—Ö–æ–¥–∏—Ç/—Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
   - –ü–æ–º–µ—á–∞–µ—Ç `hasPaid = true`
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `currency` (RUB/EUR)
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `paidAt = NOW()`
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `currentStep = 'completed'`
5. **–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω–≤–∞–π—Ç—ã:**
   - –ò–Ω–≤–∞–π—Ç –≤ –∫–∞–Ω–∞–ª —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
   - –ò–Ω–≤–∞–π—Ç –≤ —á–∞—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
6. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø** ‚úÖ

---

## üêõ Troubleshooting

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ Tribute Dashboard
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway (–µ—Å—Ç—å –ª–∏ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã?)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Railway deployment –∞–∫—Ç–∏–≤–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint

### –ü–ª–∞—Ç–µ–∂ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `telegram_user_id` –≤ webhook –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞

### –ò–Ω–≤–∞–π—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º –∫–∞–Ω–∞–ª–∞ –∏ —á–∞—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ CHANNEL_ID –∏ CHAT_ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤ .env

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ webhook –æ—Ç Tribute:**

```typescript
{
  name: "new_subscription",
  created_at: "2025-03-20T01:15:58.33246Z",
  sent_at: "2025-03-20T01:15:58.542279448Z",
  payload: {
    subscription_name: string,
    subscription_id: number,
    period_id: number,
    period: "monthly" | "yearly",
    price: number,        // –í –º–∏–Ω–æ—Ä–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö (–∫–æ–ø–µ–π–∫–∏/—Ü–µ–Ω—Ç—ã)
    amount: number,       // –ü–æ—Å–ª–µ –∫–æ–º–∏—Å—Å–∏–∏
    currency: "rub" | "eur" | "usd",
    user_id: number,      // ID –≤ Tribute
    telegram_user_id: number,  // ID –≤ Telegram ‚ö°Ô∏è
    channel_id: number,
    channel_name: string,
    expires_at: string
  }
}
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π Checklist

- [ ] –ü–æ–ª—É—á–∏—Ç—å Railway URL –∏–∑ Dashboard
- [ ] –î–æ–±–∞–≤–∏—Ç—å Webhook URL –≤ Tribute: `https://YOUR-DOMAIN.railway.app/webhook/tribute`
- [ ] –£–∫–∞–∑–∞—Ç—å API Key: `32fc5725-78c2-40aa-990d-dfebf6ec`
- [ ] –í–∫–ª—é—á–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `new_subscription`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ curl –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Railway
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–ª–∞—Ç–µ–∂ –ø–æ—è–≤–∏–ª—Å—è –≤ –ë–î
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏–Ω–≤–∞–π—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

---

**–ì–æ—Ç–æ–≤–æ!** üéâ 

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Tribute –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–Ω–∞–ª—É –∏ —á–∞—Ç—É!
