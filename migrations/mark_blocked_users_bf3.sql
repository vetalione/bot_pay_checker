-- Помечаем 108 пользователей как заблокировавших бота
-- Данные извлечены из логов Railway BF Day 3 (16.11.2025)
-- Рассылка: totalAttempted = 457, totalSent = 349, заблокировали = 108

UPDATE users 
SET "blockedBot" = true, 
    "blockedAt" = '2025-11-16 18:26:06'
WHERE "userId" IN (
  4727406, 40074234, 45552948, 75177609, 77435282, 89528793,
  119021353, 134753455, 147878558, 201045794, 220446675, 225382036,
  252961879, 269933924, 271688475, 283137883, 295404732, 319049114,
  322328534, 324366654, 327889818, 330138077, 333571936, 334946493,
  352498140, 352741679, 357459758, 372672981, 380925696, 380939785,
  385132404, 388629935, 412728855, 426150546, 428792981, 432508235,
  452191715, 489538594, 495331666, 507093866, 509742074, 531451278,
  534906195, 546732422, 548533898, 561959010, 575643537, 578096849,
  584179879, 618105007, 627505246, 632998362, 657770943, 662767361,
  664515029, 665676494, 675453154, 738308959, 742303648, 757780045,
  779921610, 792628738, 796010859, 807504129, 826360500, 869623213,
  880650186, 893292121, 895118816, 899585891, 905038515, 906787465,
  909609684, 924655176, 950395080, 951825408, 971528068, 1028698299,
  1033015787, 1045287296, 1077812583, 1093230824, 1151365806, 1228377191,
  1234916441, 1286917658, 1315753835, 1316514370, 1341373992, 1411944397,
  1740829472, 1873942568, 1874566694, 1920077783, 1922414680, 5092277524,
  5104354844, 5228960885, 5419968544, 6284113769, 6470708181, 6584653871,
  6610810187, 6683446378, 7105543163, 7162022416, 7964429482, 8475415551
)
AND "blockedBot" = false; -- Применяем только к еще не помеченным

-- Итоговая статистика
SELECT 
  COUNT(*) as total_blocked,
  COUNT(*) FILTER (WHERE "currentStep" = 'start') as blocked_start,
  COUNT(*) FILTER (WHERE "currentStep" = 'video1') as blocked_video1,
  COUNT(*) FILTER (WHERE "currentStep" = 'video2') as blocked_video2,
  COUNT(*) FILTER (WHERE "currentStep" = 'video3') as blocked_video3,
  COUNT(*) FILTER (WHERE "currentStep" = 'payment_choice') as blocked_payment_choice,
  COUNT(*) FILTER (WHERE "currentStep" = 'waiting_receipt') as blocked_waiting_receipt
FROM users
WHERE "blockedBot" = true;
